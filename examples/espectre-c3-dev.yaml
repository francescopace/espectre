# ESPectre - ESP32-C3 Development Configuration
# WiFi CSI-based motion detection - LOCAL DEVELOPMENT VERSION
#
# This file uses local components for development.
# For production use, see espectre-c3.yaml (uses GitHub source).
#
# Tested boards (community verified):
# - ESP32-C3 Super Mini (AliExpress/Temu, tested by @mvfc, @francescopace)
# - AirM2M Core ESP32-C3 (tested by @WLaoDuo)
#
# ESP32-C3 Super Mini Notes:
# - Set traffic_generator_rate to 94 or less (higher values cause calibration issues)
# - Boards with USB-UART bridges (CH343, CP2102): uncomment hardware_uart in logger section (tested by @gasment)
# - Some cheap clones may require DIO flash mode - see platformio_options below
#
# Usage:
# 1. Clone the repository: git clone https://github.com/francescopace/espectre.git
# 2. cd espectre
# 3. Create secrets.yaml with wifi_ssid and wifi_password
# 4. Run: esphome run examples/espectre-c3-dev.yaml

esphome:
  name: espectre
  friendly_name: ESPectre Dev
  min_version: 2025.11.0
  # Uncomment for ESP32-C3 Super Mini clones with flash issues (use DIO instead of QIO)
  # platformio_options:
  #   board_build.flash_mode: dio

esp32:
  variant: ESP32C3
  framework:
    type: esp-idf

# Local component for development
external_components:
  - source:
      type: local
      path: ../components
    components: [ espectre ]

# ESPectre - WiFi CSI Motion Detection
# Note: For Super Mini boards, keep traffic_generator_rate <= 94
# All parameters shown with defaults
espectre:
  id: espectre_csi
  # Traffic Generator
  traffic_generator_rate: 100   # Packets/sec for CSI generation (0-1000)
  traffic_generator_mode: dns   # dns (default) or ping
  # Signal Processing
  gain_lock: auto               # auto (default), enabled, disabled
  detection_algorithm: mvs      # mvs (default, Moving Variance) or pca (Principal Component Analysis)
  # MVS (Moving Variance Segmentation), ignored by PCA
  segmentation_calibration: nbvi  # nbvi (default) or p95
  segmentation_threshold: auto  # auto (default), min, or 0.1-10.0
  segmentation_window_size: 50  # Analysis window size in packets (10-200)
  # Filters (optional)
  hampel_enabled: false         # Outlier removal (default: false)
  hampel_window: 9              # Filter window size (3-11, odd numbers)
  hampel_threshold: 4.0         # Outlier detection threshold (1.0-10.0)
  lowpass_enabled: false        # Noise reduction (default: false)
  lowpass_cutoff: 11.0          # Cutoff frequency in Hz (5.0-20.0)
  # Manual subcarrier override (leave commented for auto-calibration)
  #selected_subcarriers: [11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22]

# WiFi (using secrets for development)
wifi:
  networks:
    - ssid: !secret wifi_ssid
      password: !secret wifi_password
      #bssid: !secret wifi_bssid  # Lock to specific Access Point (useful for mesh networks)

# Logging (DEBUG level for development)
# Note: ESPHome defaults to native USB Serial/JTAG on C3. Boards with external USB-UART
# bridges (like CH343, CP2102) need hardware_uart: UART0 to see logs.
logger:
  level: DEBUG
  logs:
    sensor: INFO
    binary_sensor: INFO
  # hardware_uart: UART0

# Home Assistant API
api:

# OTA updates
ota:
  - platform: esphome

# Debug sensors for development
debug:
  update_interval: 5s

sensor:
  - platform: debug
    free:
      name: "Free Heap"
    block:
      name: "Max Free Block"
    loop_time:
      name: "Loop Time"

text_sensor:
  - platform: debug
    device:
      name: "Device Info"
    reset_reason:
      name: "Reset Reason"

