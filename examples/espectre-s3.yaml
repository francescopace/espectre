# ESPectre - ESP32-S3 Configuration
# WiFi CSI-based motion detection with Home Assistant integration
#
# Quick Start:
# 1. Copy this file to your ESPHome config directory
# 2. Edit wifi ssid and password below
# 3. Run: esphome run espectre-s3.yaml

esphome:
  name: espectre

esp32:
  variant: ESP32S3
  framework:
    type: esp-idf
    version: 5.5.1
    sdkconfig_options:
      # Power Management (critical for CSI reliability)
      CONFIG_PM_ENABLE: n                             # Disable all power management
      CONFIG_ESP_WIFI_STA_DISCONNECTED_PM_ENABLE: n   # No power save when disconnected
      # CSI Feature
      CONFIG_ESP_WIFI_CSI_ENABLED: y                  # Enable CSI extraction from WiFi packets
      # PSRAM Support (8MB on most S3 boards)
      CONFIG_SPIRAM: y                                # Enable SPIRAM/PSRAM
      CONFIG_SPIRAM_IGNORE_NOTFOUND: y                # Continue if PSRAM not found
      CONFIG_SPIRAM_TYPE_AUTO: y                      # Automatic detection of PSRAM type
      CONFIG_SPIRAM_SPEED_80M: y                      # 80MHz PSRAM clock
      CONFIG_SPIRAM_BOOT_INIT: y                      # Initialize at boot
      CONFIG_SPIRAM_USE_MALLOC: y                     # Use PSRAM for malloc/heap
      CONFIG_SPIRAM_MALLOC_ALWAYSINTERNAL: "8192"     # Small allocations (<8KB) use internal RAM
      CONFIG_SPIRAM_MALLOC_RESERVE_INTERNAL: "32768"  # Reserve 32KB internal for DMA
      CONFIG_SPIRAM_ALLOW_STACK_EXTERNAL_MEMORY: y    # Required for some operations
      CONFIG_SPIRAM_TRY_ALLOCATE_WIFI_LWIP: n         # Disable WiFi allocation from PSRAM

wifi:
  ssid: "YOUR_WIFI_SSID"
  password: "YOUR_WIFI_PASSWORD"

# Load ESPectre component from GitHub
external_components:
  - source:
      type: git
      url: https://github.com/francescopace/espectre
      ref: main
    components: [ espectre ]
    refresh: always

# ESPectre - WiFi CSI Motion Detection
espectre:

# Enable logging
logger:

# Enable API for Home Assistant
api:

# Enable OTA updates via ESPHome
ota:
  - platform: esphome