<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESPectre - The Game | WiFi Motion Reaction Game</title>
    <meta name="description" content="A reaction game powered by ESPectre WiFi motion detection. Stay still. Move fast. No controller needed - just your body and WiFi.">
    <meta name="keywords" content="ESPectre, WiFi sensing, CSI, motion detection, game, reaction game, ESP32">
    <meta name="author" content="Francesco Pace">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://espectre.dev/game/">

    <!-- Open Graph / Facebook -->
    <meta property="og:url" content="https://espectre.dev/game/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="ESPectre - The Game | WiFi Motion Reaction Game">
    <meta property="og:description" content="A reaction game powered by WiFi motion detection. No controller needed - just your body and WiFi.">
    <meta property="og:image" content="https://espectre.dev/espectre.png">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:domain" content="espectre.dev">
    <meta property="twitter:url" content="https://espectre.dev/game/">
    <meta name="twitter:title" content="ESPectre - The Game | WiFi Motion Reaction Game">
    <meta name="twitter:description" content="A reaction game powered by WiFi motion detection. No controller needed - just your body and WiFi.">
    <meta name="twitter:image" content="https://espectre.dev/espectre.png">

    <!-- Favicon -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ‘»</text></svg>">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-S0NQNG0V11"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-S0NQNG0V11');
    </script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Styles -->
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="game.css">
</head>

<body class="game-page">
    <canvas id="cosmic-bg"></canvas>

    <header id="site-header">
        <noscript>
            <a href="/" class="logo">ESPectre</a>
            <nav>
                <a href="/">Home</a>
                <a href="https://github.com/francescopace/espectre">GitHub</a>
                <a href="https://github.com/francescopace/espectre/issues">Issues</a>
                <a href="https://github.com/francescopace/espectre/discussions">Discussions</a>
            </nav>
        </noscript>
    </header>

    <!-- Vertical Movement Bar (always visible, left side) -->
    <div id="movement-bar-vertical" class="movement-bar-vertical">
        <div class="movement-bar-track">
            <div id="movement-fill" class="movement-bar-fill"></div>
            <!-- Threshold marker (draggable) -->
            <div id="threshold-marker" class="threshold-marker" title="Drag to adjust threshold">
                <span id="threshold-value" class="threshold-value">1.0</span>
            </div>
        </div>
    </div>
    
    <main class="game-container">

        <!-- Connection Screen -->
        <div id="screen-connect" class="game-screen active">
            <div class="game-title">
                <h1>ESPectre</h1>
                <span class="game-subtitle">THE GAME</span>
            </div>
            
            <p class="game-tagline">Stay still. Move fast. React to survive.</p>
            
            <div id="connection-box" class="connection-box">
                <!-- Pre-connection state -->
                <div id="connection-pre" class="connection-pre">
                    <button id="btn-connect" class="btn btn-primary btn-large">
                        <i class="fab fa-usb"></i> Connect ESPectre
                    </button>
                    <p class="connection-hint">Connect your ESP32 with ESPectre firmware via USB</p>
                    <div id="connection-status" class="connection-status"></div>
                </div>
                
                <!-- Post-connection state (USB ready) -->
                <div id="connection-ready" class="connection-ready hidden">
                    <div class="usb-ready-status">
                        <i class="fas fa-check-circle"></i>
                        <span id="usb-device-name">ESP32 Connected</span>
                    </div>
                    
                    <!-- System Info Panel -->
                    <div id="system-info" class="system-info hidden">
                        <div class="system-info-grid">
                            <span class="info-label">Threshold</span>
                            <span id="info-threshold" class="info-value">--</span>
                            <span class="info-label">Window</span>
                            <span id="info-window" class="info-value">--</span>
                            <span class="info-label">Subcarriers</span>
                            <span id="info-subcarriers" class="info-value">--</span>
                            <span class="info-label">Low-pass</span>
                            <span id="info-lowpass" class="info-value">--</span>
                            <span class="info-label">Hampel</span>
                            <span id="info-hampel" class="info-value">--</span>
                            <span class="info-label">Traffic</span>
                            <span id="info-traffic" class="info-value">--</span>
                        </div>
                    </div>
                    
                    <div class="connection-buttons">
                        <button id="btn-start-game" class="btn btn-primary btn-large">
                            <i class="fas fa-play"></i> Start Game
                        </button>
                        <button id="btn-disconnect" class="btn btn-secondary btn-small">
                            <i class="fas fa-unlink"></i> Disconnect
                        </button>
                    </div>
                </div>
            </div>
            
            <div id="divider-mouse" class="divider">
                <span>or</span>
            </div>
            
            <button id="btn-touch" class="btn btn-primary btn-large" style="display: none;">
                <i class="fas fa-hand-pointer"></i> Play with Swipe
            </button>
            <p id="mobile-usb-hint" class="mobile-usb-hint" style="display: none;">
                <i class="fas fa-laptop"></i> For real WiFi motion detection, play on a PC with USB connection
            </p>
            
            <button id="btn-mouse" class="btn btn-secondary" style="display: none;">
                <i class="fas fa-mouse"></i> Play with Mouse
            </button>
            <p id="mouse-hint" class="keyboard-hint" style="display: none;">Move your mouse to simulate motion detection</p>
            
            <div class="how-to-play">
                <h3><i class="fas fa-question-circle"></i> How to Play</h3>
                <!-- Desktop instructions -->
                <ol class="desktop-only">
                    <li>Connect your device via USB (close any serial monitor first!)</li>
                    <li class="threshold-hint">Drag the <strong>threshold</strong> slider on the left to adjust sensitivity</li>
                    <li>Once started, <strong>stay still</strong> and wait for the Spectre</li>
                    <li>When the Spectre appears, <strong>move quickly</strong> to defeat it!</li>
                    <li>React faster than the Spectre to win</li>
                </ol>
                <!-- Mobile instructions -->
                <ol class="mobile-only">
                    <li>Tap <strong>Play with Swipe</strong> to start</li>
                    <li><strong>Stay still</strong> and wait for the Spectre</li>
                    <li><strong>Swipe fast</strong> to defeat the spectre</li>
                    <li>React faster than the Spectre to win</li>
                </ol>
                <p class="compatibility-note desktop-only"><i class="fas fa-info-circle"></i> Requires Chrome/Edge.</p>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="screen-game" class="game-screen">
            <div class="game-hud">
                <div class="hud-left">
                    <div class="hud-item">
                        <span class="hud-label"><i class="fas fa-ghost"></i> IN WAVE</span>
                        <span id="wave-progress" class="hud-value">0/3</span>
                    </div>
                    <div class="hud-item">
                        <span class="hud-label">WAVE</span>
                        <span id="wave" class="hud-value">1/15</span>
                    </div>
                </div>
                <div class="hud-center">
                    <!-- Controls are now global, outside game screen -->
                </div>
                <div class="hud-right">
                    <div class="hud-item">
                        <span class="hud-label">BEST</span>
                        <span id="best-time" class="hud-value">---</span>
                    </div>
                    <div class="hud-item">
                        <span class="hud-label">SCORE</span>
                        <span id="score" class="hud-value">0</span>
                    </div>
                </div>
            </div>

            <div class="game-arena">
                <!-- Enemy Spectre -->
                <div id="enemy" class="enemy">
                    <div class="enemy-glow"></div>
                    <div class="enemy-body">ðŸ‘»</div>
                    <div class="enemy-name" id="enemy-name">WISP</div>
                    <!-- Enemy HP Bar (for multi-HP enemies) -->
                    <div id="enemy-hp-bar" class="enemy-hp-bar hidden">
                        <div id="enemy-hp-fill" class="enemy-hp-fill"></div>
                        <span id="enemy-hp-text" class="enemy-hp-text">3/3</span>
                    </div>
                </div>
                
                <!-- Hit Strength Indicator -->
                <div id="hit-strength" class="hit-strength hidden">STRONG!</div>

                <!-- Game Message -->
                <div id="game-message" class="game-message">
                    <span class="message-text">GET READY...</span>
                </div>

                <!-- Reaction Time Display -->
                <div id="reaction-time" class="reaction-time hidden">
                    <span class="reaction-value">287</span>
                    <span class="reaction-unit">ms</span>
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="screen-results" class="game-screen">
            <h2 class="results-title">GAME OVER</h2>
            
            <div class="result-score-highlight">
                <span class="score-label">FINAL SCORE</span>
                <span class="score-value" id="result-score">0</span>
            </div>

            <div class="results-stats">
                <div class="stat-item">
                    <span class="stat-value" id="result-wave">1</span>
                    <span class="stat-label">Wave Reached</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="result-spectres">0</span>
                    <span class="stat-label">Spectres Dissolved</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="result-best">---</span>
                    <span class="stat-label">Best Reaction</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="result-streak">0</span>
                    <span class="stat-label">Max Streak</span>
                </div>
                <div class="stat-item highlight">
                    <span class="stat-value" id="result-avg-power">0.0x</span>
                    <span class="stat-label">Avg Power</span>
                </div>
                <div class="stat-item highlight">
                    <span class="stat-value" id="result-critical">0</span>
                    <span class="stat-label">Critical Hits</span>
                </div>
            </div>

            <div class="results-actions">
                <button id="btn-play-again" class="btn btn-primary">
                    <i class="fas fa-redo"></i> Play Again
                </button>
                <button id="btn-share" class="btn btn-secondary">
                    <i class="fas fa-share"></i> Share Results
                </button>
            </div>
        </div>
    </main>

    <footer id="site-footer"></footer>

    <script src="../components.js"></script>
    <script>loadHeader({ isGamePage: true }); loadFooter();</script>
    <script src="../cosmic-bg.js"></script>
    <script src="../analytics.js"></script>
    <script src="game.js"></script>
    
    <!-- Buy Me a Coffee Widget -->
    <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="espectre" data-description="Support me on Buy me a coffee!" data-color="#40DCA5" data-position="Right" data-x_margin="18" data-y_margin="18"></script>
</body>

</html>

